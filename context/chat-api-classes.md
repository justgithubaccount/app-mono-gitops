–í–æ—Ç –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–ª–∞—Å—Å–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ `AI Chat Microservice`, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ —Å–ª–æ—è–º:

---

# üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤ AI Chat Microservice

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ FastAPI, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ —Å–ª–æ—è–º (core, services, schemas, models, integrations), —Ä–∞—Å—à–∏—Ä–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–≤–µ–¥–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ (CrewAI-style) —á–µ—Ä–µ–∑ Notion.

---

## üìÅ `app/main.py`

**–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞** ‚Äî —Å–æ–∑–¥–∞—ë—Ç FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–¥–∫–ª—é—á–∞–µ—Ç:

* —Ä–æ—É—Ç–µ—Ä—ã (`api_router`, `health_router`),
* CORS,
* OpenTelemetry-—Ç—Ä–µ–π—Å–∏–Ω–≥ (`setup_tracing`),
* –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ Notion —á–µ—Ä–µ–∑ `BehaviorManager`.

---

## üß† –°–ª–æ–π: `behavior`

### `BehaviorDefinition`

```python
class BehaviorDefinition(BaseModel):
    agents: List[AgentSchema]
    tasks: List[TaskSchema]
    process: Optional[str]
```

* –û–ø–∏—Å—ã–≤–∞–µ—Ç YAML-—Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–≤–µ–¥–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ (—Ä–æ–ª—å, —Ü–µ–ª—å, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–¥–∞—á–∏).

### `AgentSchema`

* –ê–≥–µ–Ω—Ç –≤ —Å—Ç–∏–ª–µ CrewAI: `role`, `goal`, `backstory`, `tools`, `tasks`.

### `TaskSchema`

* –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—É—é –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å (–æ–ø–∏—Å–∞–Ω–∏–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∞–≥–µ–Ω—Ç).

---

## üß© –°–ª–æ–π: `schemas`

### `Message`, `ChatRequest`, `ChatResponse`

* Pydantic-—Å—Ö–µ–º—ã, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç –æ–±—â–µ–Ω–∏—è —Å LLM.

### `ProjectInfo`, `CreateProjectRequest`

* –°—Ö–µ–º—ã –ø—Ä–æ–µ–∫—Ç–æ–≤ (ID, –∏–º—è), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø—Ä–æ–µ–∫—Ç—ã —Å –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤.

---

## üíæ –°–ª–æ–π: `models`

### `StoredChatMessage`, `ChatHistory`

* –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –ø–∞–º—è—Ç–∏: –∫—Ç–æ —Å–∫–∞–∑–∞–ª, —á—Ç–æ, –∫–æ–≥–¥–∞, trace\_id/span\_id.

---

## üõ† –°–ª–æ–π: `services`

### `ChatService`

* –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:

  * –≤—ã–∑—ã–≤–∞–µ—Ç LLM (`OpenRouterClient`),
  * –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è (—á–µ—Ä–µ–∑ `enrich_context`),
  * –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –≤—ã–≤–æ–¥–∏—Ç –º–µ—Ç–∫–∏ (`job=chat`, `trace_id`).

---

## üß¨ –°–ª–æ–π: `core`

### `OpenRouterClient`

* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç (httpx), –≤—ã–∑—ã–≤–∞–µ—Ç `/chat/completions` –Ω–∞ LiteLLM/LLM API.
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `project_id`, `user_api_key`, `trace_id`.

### `ProjectMemory`

* –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –∏—Ö –∏—Å—Ç–æ—Ä–∏–∏ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–∫–µ.

### `health.py`

* `/health` endpoint –¥–ª—è Kubernetes.

### `config.py`

* `Settings` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env`: —Ç–æ–∫–µ–Ω—ã, URL LLM, –º–æ–¥–µ–ª—å, project\_name.

---

## üß© –°–ª–æ–π: `integrations`

### `NotionClient`

* –û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ API Notion, –ø–æ–ª—É—á–∞–µ—Ç YAML-–¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∞–≥–µ–Ω—Ç–æ–≤.

### `BehaviorManager`

* –ó–∞–≥—Ä—É–∂–∞–µ—Ç YAML –∏–∑ Notion ‚Üí –ø–∞—Ä—Å–∏—Ç –≤ `BehaviorDefinition`.
* –î–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ `app.state.behavior_manager`.

---

## üìú API

### `/api/v1/chat`

* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –≤—ã–∑–æ–≤ LLM ‚Üí –≤–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞.

### `/api/v1/projects`

* –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤.

### `/api/v1/projects/{id}/chat`

* –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞.

### `/behavior/schema`

* –û—Ç–¥–∞—ë—Ç —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏–∑ Notion.

---

## üß™ –¢–µ—Å—Ç—ã

–¢–µ—Å—Ç—ã (WIP):

* `tests/behavior/test_models.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º `BehaviorDefinition`.
* `tests/test_logging.py` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ enrich\_context –∏ –ª–æ–≥–æ–≤.

---

## üì¶ –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

* ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Crew YAML —á–µ—Ä–µ–∑ `Crew.load(...)`
* ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Vector/Loki —á–µ—Ä–µ–∑ job-—Ç–µ–≥–∏
* üîÑ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–∞ behavior –Ω–∞–ø—Ä—è–º—É—é –≤ Crew (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ crewai CLI –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏)

---

–ï—Å–ª–∏ —Ç–µ–±–µ –Ω—É–∂–Ω–æ:

* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤
* –°—Å—ã–ª–∫–∏ –º–µ–∂–¥—É API endpoints –∏ –∫–ª–∞—Å—Å–∞–º–∏
* –ü–æ–ª–Ω—ã–π OpenAPI spec + JSON schemas

‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏, –∏ —è —Å–≥–µ–Ω–µ—Ä–∏—Ä—É—é.
