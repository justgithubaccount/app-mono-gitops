apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "chat-api.fullname" . }}-vector-config
  namespace: {{ .Values.namespace | default "chat-api" }}
data:
  vector.toml: |
    [sources.otel]
    type = "opentelemetry"

    [sources.otel.http]
    address = "0.0.0.0:4318"

    [sources.otel.grpc]
    address = "0.0.0.0:4317"

    [sinks.loki]
    type = "loki"
    inputs = ["otel.logs"]
    endpoint = "{{ .Values.vector.lokiEndpoint }}"
    encoding.codec = "json"
    labels.app = "{{ include "chat-api.name" . }}"
    labels.env = "{{ .Values.vector.env }}"
